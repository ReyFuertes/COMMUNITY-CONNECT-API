<div class="page-container">
  <header class="page-header">
    <div class="header-info">
      <h1 class="page-title">Dashboard Overview</h1>
      <p class="page-desc">Real-time status and operational metrics for the community.</p>
    </div>
  </header>

  <!-- Zone A: Critical KPI Cards -->
  <div class="stats-overview">
    <div class="stat-card orange">
      <div class="stat-icon"><i class="pi pi-wrench"></i></div>
      <div class="stat-detail">
        <span class="label">Maintenance</span>
        <div class="value">12 Open Jobs</div>
      </div>
    </div>
    <div class="stat-card red">
      <div class="stat-icon"><i class="pi pi-exclamation-circle"></i></div>
      <div class="stat-detail">
        <span class="label">Reports</span>
        <div class="value">5 Unresolved</div>
      </div>
    </div>
    <div class="stat-card blue">
      <div class="stat-icon"><i class="pi pi-file"></i></div>
      <div class="stat-detail">
        <span class="label">Documents</span>
        <div class="value">8 Pending</div>
      </div>
    </div>
    <div class="stat-card teal">
      <div class="stat-icon"><i class="pi pi-wallet"></i></div>
      <div class="stat-detail">
        <span class="label">Financials</span>
        <div class="value">15 Unpaid</div>
      </div>
    </div>
    <div class="stat-card purple">
      <div class="stat-icon"><i class="pi pi-ban"></i></div>
      <div class="stat-detail">
        <span class="label">Violations</span>
        <div class="value">3 Active</div>
      </div>
    </div>
  </div>

  <div class="main-dashboard-grid">
    
    <!-- Zone B: Operations Hub (Left Column) -->
    <div class="operations-section">
      <div class="card-container tab-card">
        <p-tabs value="0">
          <p-tablist>
            <p-tab value="0">Maintenance</p-tab>
            <p-tab value="1">Payments</p-tab>
            <p-tab value="2">Reports</p-tab>
            <p-tab value="3">Violations</p-tab>
          </p-tablist>
          <p-tabpanels>
            <!-- Tab 1: Maintenance -->
            <p-tabpanel value="0">
              <p-table [value]="(maintenanceRequests$ | async) ?? []" styleClass="p-datatable-sm" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Unit</th>
                    <th>Issue</th>
                    <th>Status</th>
                    <th>Date</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-req>
                  <tr>
                    <td><span class="unit-id">{{req.unit}}</span></td>
                    <td>{{req.issue}}</td>
                    <td><p-tag [value]="req.status" [severity]="getSeverity(req.status)"></p-tag></td>
                    <td class="date-cell">{{req.date}}</td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabpanel>

            <!-- Tab 2: Payments -->
            <p-tabpanel value="1">
              <p-table [value]="(payments$ | async) ?? []" styleClass="p-datatable-sm" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Unit</th>
                    <th>Resident</th>
                    <th>Amount</th>
                    <th>Status</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-pay>
                  <tr>
                    <td><span class="unit-id">{{pay.unit}}</span></td>
                    <td>{{pay.resident}}</td>
                    <td>{{pay.amount}}</td>
                    <td><p-tag [value]="pay.status" [severity]="getSeverity(pay.status)"></p-tag></td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabpanel>

            <!-- Tab 3: Reports & Concerns -->
            <p-tabpanel value="2">
              <p-table [value]="(reports$ | async) ?? []" styleClass="p-datatable-sm" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Type</th>
                    <th>Reporter</th>
                    <th>Status</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rep>
                  <tr>
                    <td>{{rep.type}}</td>
                    <td>{{rep.reporter}}</td>
                    <td><p-tag [value]="rep.status" [severity]="getSeverity(rep.status)"></p-tag></td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabpanel>

            <!-- Tab 4: Violations -->
            <p-tabpanel value="3">
              <p-table [value]="(violations$ | async) ?? []" styleClass="p-datatable-sm" [paginator]="true" [rows]="5">
                <ng-template pTemplate="header">
                  <tr>
                    <th>Unit</th>
                    <th>Violation</th>
                    <th>Fine</th>
                    <th>Status</th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-vio>
                  <tr>
                    <td><span class="unit-id">{{vio.unit}}</span></td>
                    <td>{{vio.type}}</td>
                    <td class="fine-amount">{{vio.fine}}</td>
                    <td><p-tag [value]="vio.status" severity="danger"></p-tag></td>
                  </tr>
                </ng-template>
              </p-table>
            </p-tabpanel>
          </p-tabpanels>
        </p-tabs>
      </div>

      <!-- Recent Residents (Moved from old layout, kept for context) -->
      <div class="card-container recent-residents-card">
        <div class="header-row">
          <h3 class="card-title">Recent Residents</h3>
          <p-button label="View All" [text]="true" size="small" styleClass="btn-default"></p-button>
        </div>
        <div class="people-grid">
          <div class="person-item" *ngFor="let person of (people$ | async) ?? []">
            <p-avatar *ngIf="person.image" [image]="person.image" shape="circle" size="large"></p-avatar>
            <div *ngIf="!person.image" class="avatar-placeholder" [style.backgroundColor]="person.color">{{person.initials}}</div>
            <span class="person-name">{{person.name}}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Zone C: Schedule & Approvals (Right Column) -->
    <div class="side-section">
      
      <!-- Bookings Timeline -->
      <div class="card-container schedule-card">
        <h3 class="card-title">Today's Schedule</h3>
        <p-timeline [value]="(todayBookings$ | async) ?? []" align="left" styleClass="customized-timeline">
          <ng-template pTemplate="content" let-event>
            <div class="timeline-event">
              <span class="time">{{event.time}}</span>
              <div class="event-detail">
                <span class="event-name">{{event.event}}</span>
                <span class="event-user">{{event.user}}</span>
              </div>
            </div>
          </ng-template>
          <ng-template pTemplate="marker" let-event>
            <span class="custom-marker shadow-sm" [style.backgroundColor]="'#0084FF'">
              <i class="pi pi-calendar"></i>
            </span>
          </ng-template>
        </p-timeline>
      </div>

      <!-- Approvals (Registrations & Docs) -->
      <div class="card-container">
        <div class="header-row">
          <h3 class="card-title">Pending Approvals</h3>
        </div>
        <div class="approval-list">
          <div class="approval-item" *ngFor="let item of (pendingApprovals$ | async) ?? []">
            <div class="item-icon" [style.backgroundColor]="item.color + '1A'" [style.color]="item.color">
              <i [class]="item.icon"></i>
            </div>
            <div class="item-info">
              <span class="item-type">{{item.type}}</span>
              <span class="item-detail">{{item.detail}}</span>
            </div>
            <p-button icon="pi pi-chevron-right" [text]="true" [rounded]="true" severity="secondary"></p-button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
